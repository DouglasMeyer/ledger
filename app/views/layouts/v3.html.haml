!!! 5
%html(manifest="#{v3_manifest_path if Rails.env.production?}")
  %head
    %title Ledger
    = stylesheet_link_tag    "normalize", "v3", :media => "all"
    = javascript_include_tag "v3"
    = csrf_meta_tags
    %meta(name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1")
    %meta(name="google" value="notranslate")

  %body(class="#{controller_name} #{action_name}" ng-app="ledger")
    .navigation(ng-controller="NavigationCtrl")
      .navigation__toggle(ng-click="toggle()") =

      .page-actions
        .page-actions__calculator(ng-controller="CalculatorCtrl")
          %label.is-clickable.icon-calculator(for="calculator" ng-click="toggle()")
          %form.dropdown(name="form" ng-cloak ng-show="showCalc")
            %pre.l-text-r(ng-model="output" l-currency)
            %input#calculator.l-text-r(type="text" ng-model="input" name="input")
        = yield :navigation
        %span( ng-cloak
          ng-repeat="pageAction in pageActions"
          class="is-clickable icon-{{pageAction.icon}}"
          title="{{pageAction.text}}"
          ng-click="pageAction.click()"
        )

      .navigation__details(ng-class="{ 'is-open': showNav }")
        = link_to "Accounts", v3_root_path(anchor: '/accounts'), 'ng-click' => 'showNav=false', class: 'accounts navigation__page'
        = link_to v3_root_path(anchor: '/entries'),              'ng-click' => 'showNav=false', class: 'entries navigation__page' do
          Entries
          - needs_distribution_count = BankEntry.needs_distribution.count
          - if needs_distribution_count > 0
            %span.count= needs_distribution_count
        = link_to "Strategies", v3_strategies_path, class: 'strategies navigation__page'

        - last_import = BankImport.last
        .bank_import(tabindex="0")
          %small upload
          .bank_import__details
            - if last_import
              %div last updated: #{last_import.created_at.to_s :long}
              - ledger_sum = BankEntry.sum(:amount_cents)
              - bank_delta = last_import.balance_cents - ledger_sum
              - unless bank_delta.zero?
                %div
                  bank has
                  = "+" if bank_delta > 0
                  = currency bank_delta / 100.0, '', 'span'
                  &nbsp;than ledger
            = form_tag v3_bank_imports_path, multipart: true do
              = file_field_tag :upload

      .navigation__status.list( ng-cloak
        ng-controller="StatusCtrl"
      )
        %span.list__item( ng-repeat="status in statuses"
          ng-click="status.fn && status.fn()"
          ng-class="{ 'is-clickable': status.fn }"
        ) {{status.text}}
    = yield
